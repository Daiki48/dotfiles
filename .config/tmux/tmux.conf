# tmux設定 - Daiki用
# Zellij互換のキーバインド + 安定性重視

# ==============================================================================
# 基本設定
# ==============================================================================

# プレフィックスキーをCtrl+gに変更（Zellij互換）
unbind C-b
set -g prefix C-g
bind C-g send-prefix

# TrueColor対応
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",xterm-256color:Tc,alacritty:Tc"

# エスケープキーの遅延を無効化（Vim用）
set -sg escape-time 0

# ヒストリサイズ
set -g history-limit 50000

# ウィンドウ番号を1から開始
set -g base-index 1
setw -g pane-base-index 1

# ウィンドウを閉じた時に番号を詰める
set -g renumber-windows on

# マウス有効
set -g mouse on

# フォーカスイベントを有効化（Neovim用）
set -g focus-events on

# ==============================================================================
# キーバインド - プレフィックスなし（Zellij shared互換）
# ==============================================================================

# Alt+hjkl: ペイン間フォーカス移動
bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R

# Alt+n: 下にペイン分割
bind -n M-n split-window -v -c "#{pane_current_path}"

# Alt+v: 右にペイン分割
bind -n M-v split-window -h -c "#{pane_current_path}"

# Ctrl+Shift+h/l: ウィンドウ（タブ）移動
bind -n C-S-h previous-window
bind -n C-S-l next-window

# Ctrl+Shift+t: 新規ウィンドウ（タブ）
bind -n C-S-t new-window -c "#{pane_current_path}"

# ==============================================================================
# キーバインド - プレフィックス付き（Zellij normalモード互換）
# ==============================================================================

# t: タブ操作モード的にウィンドウ選択
bind t choose-tree -Zw

# P: ペイン番号表示（大文字）
bind P display-panes

# p: 前のウィンドウ
bind p previous-window

# s: セッション選択（スクロールモード的）
bind s choose-tree -Zs

# d: デタッチ
bind d detach-client

# q: 終了確認
bind q confirm-before -p "Kill session? (y/n)" kill-session

# x: 現在のペインを閉じる
bind x confirm-before -p "Kill pane? (y/n)" kill-pane

# f: ペインをフルスクリーン切り替え
bind f resize-pane -Z

# r: 設定リロード
bind r source-file ~/.config/tmux/tmux.conf \; display "Config reloaded!"

# ウィンドウ番号で直接移動
bind 1 select-window -t 1
bind 2 select-window -t 2
bind 3 select-window -t 3
bind 4 select-window -t 4
bind 5 select-window -t 5

# ==============================================================================
# コピーモード（Vimライク）
# ==============================================================================

setw -g mode-keys vi

# コピーモードでのVimライクキーバインド
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "wl-copy"
bind -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "wl-copy"

# マウスドラッグで選択時に自動コピー
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "wl-copy"

# コピーモードでのスクロール（Zellij scroll互換）
bind -T copy-mode-vi j send-keys -X cursor-down
bind -T copy-mode-vi k send-keys -X cursor-up
bind -T copy-mode-vi d send-keys -X halfpage-down
bind -T copy-mode-vi u send-keys -X halfpage-up
bind -T copy-mode-vi G send-keys -X bottom-line

# ==============================================================================
# 外観設定 - Tokyo Night風
# ==============================================================================

# ペイン枠線を非表示に近い状態に
set -g pane-border-style "fg=#1a1b26"
set -g pane-active-border-style "fg=#565f89"

# ステータスバーの位置
set -g status-position bottom

# ステータスバーの色
set -g status-style "bg=#1a1b26,fg=#c0caf5"

# ステータスバー左側
set -g status-left-length 40
set -g status-left "#[fg=#1a1b26,bg=#7aa2f7,bold] #S #[fg=#7aa2f7,bg=#1a1b26] "

# ステータスバー右側
set -g status-right-length 60
set -g status-right "#[fg=#565f89]%Y-%m-%d #[fg=#c0caf5]%H:%M "

# ウィンドウステータス
setw -g window-status-format "#[fg=#565f89] #I:#W "
setw -g window-status-current-format "#[fg=#1a1b26,bg=#7aa2f7,bold] #I:#W "
setw -g window-status-separator ""

# メッセージスタイル
set -g message-style "bg=#1a1b26,fg=#c0caf5"

# コピーモードスタイル
setw -g mode-style "bg=#283457,fg=#c0caf5"

# ==============================================================================
# プラグイン（TPM - Tmux Plugin Manager）
# ==============================================================================

# プラグインリスト
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-resurrect'    # セッション永続化
set -g @plugin 'tmux-plugins/tmux-continuum'    # 自動保存

# tmux-resurrect設定
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-strategy-nvim 'session'

# tmux-continuum設定（自動保存間隔: 15分）
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'

# TPM初期化（この行は設定ファイルの最後に置く）
run '~/.config/tmux/plugins/tpm/tpm'
